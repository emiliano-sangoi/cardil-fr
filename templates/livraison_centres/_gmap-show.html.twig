<script>

    let map;
    let markers = [];

    // Initialize and add the map
    function initGoogleMap() {

        var centers_str = '{{ centers | raw }}';
        var centers = JSON.parse(centers_str);
        console.log(centers);

        options = {
            zoom: 7,
            streetViewControl: false
        };

        if(typeof centers[0] == 'object'){
            options.center = { lat: centers[0].latitude, lng: centers[0].longitude }
        }

        // The map, centered at Uluru
        map = new google.maps.Map(document.getElementById("map"), options);

        const image = {
            url: "https://developers.google.com/maps/documentation/javascript/examples/full/images/beachflag.png",
            // This marker is 20 pixels wide by 32 pixels high.
            size: new google.maps.Size(40, 48),
            // The origin for this image is (0, 0).
            origin: new google.maps.Point(0, 0),
            // The anchor for this image is the base of the flagpole at (0, 32).
            anchor: new google.maps.Point(0, 48),
        };

        const shape = {
            coords: [1, 1, 1, 20, 18, 20, 18, 1],
            type: "poly",
        };

        centers.forEach(function (item){
            console.log(item);

            var marker = new google.maps.Marker({
                position: { lat: item.latitude, lng: item.longitude },
                map: map,
                animation: google.maps.Animation.DROP,
                icon: image,
                shape: shape,
                title: item.nom + " - {{ "form.livraison_centre.labels.cost" | trans }}: " + item.cout + ' â‚¬'
            });

            marker.addListener("click", toggleBounce);

            markers.push(marker);

        });

        function toggleBounce() {
            if (marker.getAnimation() !== null) {
                marker.setAnimation(null);
            } else {
                marker.setAnimation(google.maps.Animation.BOUNCE);
            }
        }

    }


</script>

<script defer
        src="https://maps.googleapis.com/maps/api/js?key={{ google_maps_key }}&callback=initGoogleMap&v=weekly"></script>

<script>
    $(document).ready(function (e) {
        window.initGoogleMap = initGoogleMap;
    });
</script>
